<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    var Author = "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiI1OTAwNDI4OTA0IiwidHlwZSI6MiwiZXhwIjoxNzAzNzc3NDU0LCJpYXQiOjE3MDM2OTEwNTR9.BN8cpo3acpMtk5wATF0mYEzAzrTRRKiFWT_eVfEbauZaZQsHdZ3T-3TDObVORAAh2O15Jrl44pR541iadElKAA"
    fetch('hoadont1.json')
      .then(response => response.json())
      .then(data => {
        // const data1  = data.map((v)=>{hdhhdvu})
        let data2 = []
        console.log(data);
        data.forEach(v => {
          LoadHoadon('12',v.SHDMV)
        });
        // data.forEach((v) => {
        //   if(v)
        //   {
        //   console.log(v.hdhhdvu);
        //   if (v.hdhhdvu.length > 0) {
        //     v.hdhhdvu = v.hdhhdvu.map((v1) => {
        //       const item = { ...v1,...{ idServer: v.idServer },...{ SHD: v.shdon },...{ ttxly: v.ttxly },...{ Ngaytao: new Date(v.tdlap) } }
        //       return item
        //     });
        //   }
        //   data2 = [...data2, ...v.hdhhdvu]
        // }
        // });
        // console.log(data2);
        // console.log(data);
        // data.forEach(v => {
        //   console.log(v.nbmst, v.khhdon, v.SHD);
        //  // LoadMuavaoChitiet(v.Dulieu.nbmst, v.Dulieu.khhdon, v.SHD)
        //   //LoadMuavaoChitiet()
        // });
      })
      .catch(error => {
        console.error(error);
      });


    function CreateMuavaochitiet(item) {
      var settings = {
        "url": "http://localhost:3100/muavaochitiet",
        "method": "POST",
        "timeout": 0,
        "headers": {
          "Content-Type": "application/json"
        },
        "data": JSON.stringify(item),
      };

      $.ajax(settings).done(function (response) {
        console.log(response);
      });
    }
    function LoadHoadon(thang,SHD) {
      var settings = {
        "url": "https://hoadondientu.gdt.gov.vn:30000/query/invoices/purchase?sort=tdlap:desc,khmshdon:asc,shdon:desc&size=15&search=tdlap=ge=01/" + thang + "/2022T00:00:00;tdlap=le=31/" + thang + "/2022T22:59:59;shdon==" + SHD + "",
        "method": "GET",
        "timeout": 0,
        "headers": {
          "Authorization": "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiI1OTAwNDI4OTA0IiwidHlwZSI6MiwiZXhwIjoxNzAzOTUzMTgwLCJpYXQiOjE3MDM4NjY3ODB9.vm9TXbCODMYQ2hnP9IU7ijBu0Ix6g_UMHjA87NpI-n0AjgP6BvW1TzTFFoAoTS_v-dJouQiyRkFAl6VJgqWCbg",
          "Cookie": "TS01c977ee=01dc12c85e5956a7294eefce83587eae46217be6ce1c96fcab16f29627a3e28874a7f646be3f524f777968ca3a8a7d675b039b53ea"
        },
      };

      $.ajax(settings).done(function (response) {
        console.log(SHD,response);
      });
    }


    function LoadMuavaoChitiet(nbmst, khhdon, SHD) {
      var settings = {
        "url": "https://hoadondientu.gdt.gov.vn:30000/query/invoices/detail?nbmst=" + nbmst + "&khhdon=" + khhdon + "&shdon=" + SHD + "&khmshdon=1",
        "method": "GET",
        "timeout": 0,
        "headers": {
          "Authorization": Author,
        },
      };
      $.ajax(settings).done(function (response) {
        const item = {}
        item.SHD = SHD
        item.Dulieu = response
        item.Ngaytao = new Date(response.tdlap)
        CreateMuavaochitiet(item)
      });
    }

    $("#Muavaochitiet").click(function () {
      muavaochitiet()
    });
  </script>
</head>

<body>
  <button id="Muavaochitiet">Mua Vào Chi Tiết</button>
</body>

</html>